@import play.twirl.api.HtmlFormat
@import _root_.blackboard.index.Index._
@import _root_.blackboard.controllers.routes
@import _root_.blackboard.controllers.KnowledgeApp
@(app: KnowledgeApp, query: SearchQuery)

@views.html.ui.main("Translator: "+query.getQuery){
  @header(routes.KnowledgeApp.ksearch(null))(HtmlFormat.empty)
  <div class="container-fluid" style="margin-top: 55px; margin-bottom:10px;">
    <div id="content-panel" class="loader loader-default"></div>
    <div class="row">
      <div class="col-md-2"></div>
      <div class="col-md-8">
        <div class="card">
          <div class="card-body">
            Your query <code>@query.getQuery</code>
            @if(query.getField!=null){
              (restricted to the field <b>@query.getField</b>)
            }
            @if(query.getConcepts.size > 0){ 
              mapped to @query.getConcepts.size known concept(s):
              @if(!query.getConcepts.isEmpty){
              <ol>
                @for(c <- query.getConcepts){
                  <li><a href="@_root_.blackboard.umls.controllers.routes.Controller.cui(c.ui)">@c.name</a>
                    @if(c.getTokens != null){
                      [<code>@c.getTokens.mkString(" ")</code>]
                    }
                    with the following semantic type(s):
                    @for(t <- c.types){
                      @defining(app.semmed.umls.getSemanticType(t)){st=>
                        <code>@t</code> @if(st!=null){[@st.name]}
                      }
                    }
                  </li>
                  }
              </ol>
              }
            }else{
              does not map to any known concepts.
            }
              There are <a href="@_root_.blackboard.controllers.routes.KnowledgeApp.ksearch(query.getQuery.toString)"><span id="pub-count">...</span> publications</a> for your query.
          </div>
        </div>
      </div>
      <div class="col-md-2"></div>
    </div>
  </div>    
  }{
  <script src="@_root_.blackboard.pubmed.controllers.routes.Controller.jsRoutes" type="text/javascript"></script>
  <script src='@controllers.routes.Assets.versioned("javascripts/pubmed.js")' type="text/javascript"></script>
  }{
      $(document).ready(function() {
          var url = new URLSearchParams(window.location.search);
          get_pubmed_count('#pub-count', url.get('q'));
      });
  }
  
