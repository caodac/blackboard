@import play.twirl.api.HtmlFormat
@import _root_.blackboard.semmed.SemMedDbKSource
@import _root_.blackboard.semmed.Predication
@import _root_.blackboard.pubmed.PubMedDoc
@import _root_.blackboard.pubmed.controllers.routes.Controller
@(ks: SemMedDbKSource, doc: PubMedDoc, preds: Array[Predication])

@views.html.ui.main("SemMedDb: "+doc.getPMID){
  @navbar()
  <div class="container-fluid" style="margin-top:60px;">
    <div class="jumbotron">
      <div class="row">
        <div class="col-1" style="padding:10px">
          <span class="__dimensions_badge_embed__ pull-right"
                data-pmid="@doc.getPMID" data-style="small_circle"></span>
        </div>
        <div class="col-11">
          <h1 class="display-4">@doc.getTitle</h1>
        </div>
      </div>
      <p class="lead"><i>@doc.getJournal</i>, <b>@{new java.text.SimpleDateFormat("MMM d, yyy").format(doc.getDate)}</b></p>
      <p class="lead">PMID:<a href="https://www.ncbi.nlm.nih.gov/pubmed/@doc.getPMID">@doc.getPMID</a> <span class="fa fa-external-link"></span>
        @if(doc.getDOI != null) {
          DOI:<a href="https://dx.doi.org/@doc.getDOI">@doc.getDOI</a>
          <span class="fa fa-external-link"></span>
        }
        <a href='@Controller.pmid(doc.getPMID,"xml")'>XML</a>
        <span class="fa fa-download"></span>
        @**<a href='@Controller.pmid(doc.getPMID,"json")'>JSON</a></p>**@
      <p class="lead">
        <a class="btn btn-primary" data-toggle="collapse"
           href="#abstract-card" role="button"
           aria-expanded="false" aria-controls="abstract-card">
          Abstract</a>
      </p>
      <div class="collapse show" id="abstract-card">
        <div class="card card-body">
          @for(t <- doc.getAbstract) {
              @HtmlFormat.raw(t)
              <br>
          }
        </div>
      </div>
    </div>
    @for(p <- preds) {
      @defining(ks.umls.getConcept(p.subcui)){ sub =>
        @if(sub != null) {
          @defining(ks.umls.getConcept(p.`objcui`)){ obj =>
            @if(obj != null) {
              <div class="card">
              <div class="card-body">
              @for(e <- p.evidence) {
                @e.context<br>
              }
              </div>
              <div class="card-footer">
              @vote(p)
              <a href="@_root_.blackboard.semmed.controllers.routes.Controller.cui(sub.cui)">@sub.name</a>
              <b>@p.predicate</b>
              
              <a href="@_root_.blackboard.semmed.controllers.routes.Controller.cui(obj.cui)">@obj.name</a>
              </div>              
              </div>
              <br>
            }
          }
        }
      }
  }
</div>
}(HtmlFormat.empty){
    $(document).ready(function () {
        $('[data-toggle="tooltip"]').tooltip();
    });
}
