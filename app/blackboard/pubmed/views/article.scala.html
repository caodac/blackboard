@import play.twirl.api.HtmlFormat
@import _root_.blackboard.semmed.SemMedDbKSource
@import _root_.blackboard.semmed.Predication
@import _root_.blackboard.pubmed.PubMedDoc
@import _root_.blackboard.pubmed.index.PubMedIndex._
@import org.apache.commons.lang3.text.WordUtils

@(controller: _root_.blackboard.pubmed.controllers.Controller,
  result: SearchResult, doc: PubMedDoc)

@jstree(name: String, prefix: String) = {
  @defining(result.getFacet("@tr"+prefix)){ tr =>
    @if(tr != null) {
      @facettreecard(name, tr.getValuesWithPrefix(prefix), prefix)
    }
  }
}
  
@facettrees() = {
    @jstree("Disease", "C")
    @jstree("Chemical", "D")
    @jstree("Phenomena", "G")
    @jstree("Anatomy", "A")
    @jstree("Analytical", "E")
}

@views.html.ui.main(doc.getPMID+": "+doc.getTitle){
      <nav class="navbar fixed-top navbar-expand-lg navbar-light bg-light"
           style="z-index:9999">
        <a class="navbar-brand" href="https://ncats.nih.gov">
          <img src="/assets/images/ncats-logo.png" height="65%" width="65%"></a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav mr-auto">
              <li class="nav-item">
                <a class="nav-link" href="@_root_.blackboard.controllers.routes.KnowledgeApp.index">Home</a>
              </li>
            </ul>
            <form class="form-inline my-2 my-lg-0"
                  action="@_root_.blackboard.controllers.routes.KnowledgeApp.ksearch(null)"
                  method="GET">
              <input class="form-control mr-sm-2" type="search" name="q"
                     placeholder="ENTER SEARCH TERMS..."
                     aria-label="Search concepts" style="width:20em">
              <button class="btn btn-primary my-2 my-sm-0"
                      type="submit" style="border-radius:3rem">Search</button>
        </form>
      </div>
  </nav>
  <div class="container-fluid" style="margin-top:60px;">
    <div class="row">
      @if(result != null){
        <div class="col-md-3">
          @facettrees()
        </div>
        <div class="col-md-9">
          @articlemain(controller, doc)
        </div>
        }else{
        <div class="col-md-12">
          @articlemain(controller, doc)
        </div>        
        }
    </div>
  </div>
  }{
  <script src='@controllers.routes.Assets.versioned("javascripts/meshtreefacets.js")' type="text/javascript"></script>  
  }{
      $(document).ready(function () {
          setupTreeFacets ();
          @**
          @for(tr <- doc.getTreeNumbers){
              var tr = $.jstree.reference('#tr-@tr.charAt(0)');
              if (tr != null) {
                  tr.select_node('#@tr');
              }
          }**@
      });
}
